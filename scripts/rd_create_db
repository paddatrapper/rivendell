# create_db
#
# Create and initialize a new database for Rivendell.
#
#   (C) Copyright 2002-2003,2016 Fred Gleason <fredg@paravelsystems.com>
#
#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License version 2 as
#   published by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public
#   License along with this program; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
#

#
# Site Configuration
#

#
# Rivendell mySQL Application Account
#
RD_USER=rduser@localhost
RD_PASSWORD=letmein

#
# Default Rivendell Administrator 
#
RDA_LOGIN_NAME=admin
RDA_PASSWORD=
RDA_FULL_NAME="System Administrator"
RDA_DESCRIPTION="Default Administrator Account"

#
# Default Rivendell User
#
USER_LOGIN_NAME=user
USER_PASSWORD=
USER_FULL_NAME="Rivendell User"
USER_DESCRIPTION="Default User Account"

#
# Default Rivendell Service
#
RD_SVC_NAME="Production"
RD_SVC_DESC="Default Audio Service"

#
# Rivendell Audio Repository
#
RD_AUDIO_ROOT=/var/snd

#
# Version Information
#
SCHEMA_VERSION=1000

# Nothing should need to be changed below here!
# ############################################################################

# ############################################################################
# Create a Rivendell Database
# ############################################################################
function CreateDB {
#
# Create the database
#
mysql -u $USER -p$PASSWORD -e"CREATE DATABASE IF NOT EXISTS Rivendell"

#
# Set Security Privledges
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
    GRANT ALL ON * TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create USERS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
CREATE TABLE IF NOT EXISTS USERS (
    LOGIN_NAME CHAR(8) NOT NULL PRIMARY KEY,
    FULL_NAME CHAR(64),
    PHONE_NUMBER CHAR(20),
    DESCRIPTION CHAR(255),
    PASSWORD CHAR(32) NOT NULL,
    ADMIN_USERS_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ADMIN_CONFIG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    CREATE_CARTS_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    DELETE_CARTS_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    MODIFY_CARTS_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    EDIT_AUDIO_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ASSIGN_CART_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    CREATE_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    DELETE_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    PLAYOUT_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ARRANGE_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ADDTO_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    REMOVEFROM_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    EDIT_CATCHES_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ENABLE_WEB ENUM('N','Y') NOT NULL DEFAULT 'N',
    VOICETRACK_LOG_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    DELETE_REC_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    CONFIG_PANELS_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    MODIFY_TEMPLATE_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    ADD_PODCAST_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    EDIT_PODCAST_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    DELETE_PODCAST_PRIV ENUM('N','Y') NOT NULL DEFAULT 'N',
    INDEX FULL_NAME_IDX (FULL_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
    GRANT ALL ON USERS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create STATIONS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS STATIONS (
      NAME CHAR(64) PRIMARY KEY NOT NULL,
      DESCRIPTION CHAR(64),
      USER_NAME CHAR(8),
      DEFAULT_NAME CHAR(8),
      HEARTBEAT_CART INT,
      HEARTBEAT_INTERVAL INT,
      CUE_CARD INT,
      CUE_PORT INT DEFAULT -1,
      CUE_START_CART INT,
      CUE_STOP_CART INT,
      IPV4_ADDRESS CHAR(16),
      EDITOR_PATH CHAR(255),
      TIME_OFFSET INT,
      STARTUP_CART INT,
      FILTER_MODE INT,
      SYSTEM_MAINT ENUM('N','Y') DEFAULT 'Y',
      ENABLE_DRAGDROP ENUM('N','Y') DEFAULT 'N',
      ENFORCE_PANEL_SETUP ENUM('N','Y') DEFAULT 'N',
      HTTP_STATION CHAR(255),
      CAE_STATION CHAR(255),
      BACKUP_LIFE INT,
      BACKUP_DIR CHAR(255),
      INDEX DESCRIPTION_IDX (DESCRIPTION),
      INDEX SYSTEM_MAINT_IDX (SYSTEM_MAINT)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON STATIONS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create CART table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS CART (
      NUMBER INT UNSIGNED NOT NULL PRIMARY KEY,
      TYPE INT UNSIGNED NOT NULL,
      GROUP_NAME CHAR(10) NOT NULL,
      TITLE CHAR(255),
      ARTIST CHAR(255),
      ALBUM CHAR(255),
      YEAR DATE,
      ISRC CHAR(12),
      LABEL CHAR(64),
      CLIENT CHAR(64),
      AGENCY CHAR(64),
      USER_DEFINED CHAR(255),
      FORCED_LENGTH INT UNSIGNED,
      CUT_QUANTITY INT UNSIGNED,
      LAST_CUT_PLAYED INT UNSIGNED,
      PLAY_ORDER INT UNSIGNED,
      START_DATETIME DATETIME,
      END_DATETIME DATETIME,
      ENFORCE_LENGTH ENUM('N','Y') DEFAULT 'N',
      PRESERVE_PITCH ENUM('N','Y') DEFAULT 'N',
      INDEX GROUP_NAME_IDX (GROUP_NAME),
      INDEX TITLE_IDX (TITLE),
      INDEX ARTIST_IDX (ARTIST),
      INDEX ALBUM_IDX (ALBUM),
      INDEX LABEL_IDX (LABEL),
      INDEX CLIENT_IDX (CLIENT),
      INDEX AGENCY_IDX (AGENCY),
      INDEX USER_DEFINED_IDX (USER_DEFINED)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON CART TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create CUTS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS CUTS (
      CUT_NAME CHAR(12) PRIMARY KEY NOT NULL,
      CART_NUMBER INT UNSIGNED NOT NULL,
      DESCRIPTION CHAR(64),
      OUTCUE CHAR(64),
      LENGTH INT UNSIGNED,
      ORIGIN_DATETIME DATETIME DEFAULT '1000-01-01 00:00:00',
      START_DATETIME DATETIME DEFAULT '1000-01-01 00:00:00',
      END_DATETIME DATETIME DEFAULT '1000-01-01 00:00:00',
      START_DAYPART TIME DEFAULT '00:00:00',
      END_DAYPART TIME DEFAULT '00:00:00',
      ORIGIN_NAME CHAR(64),
      WEIGHT INT UNSIGNED DEFAULT 1,
      LAST_PLAY_DATETIME DATETIME,
      PLAY_COUNTER INT UNSIGNED DEFAULT 0,
      CODING_FORMAT INT UNSIGNED,
      SAMPLE_RATE INT UNSIGNED,
      BIT_RATE INT UNSIGNED,
      CHANNELS INT UNSIGNED,
      PLAY_GAIN INT DEFAULT 0,
      START_POINT INT DEFAULT -1,
      END_POINT INT DEFAULT -1,
      FADEUP_POINT INT DEFAULT -1,
      FADEDOWN_POINT INT DEFAULT -1,
      SEGUE_START_POINT INT DEFAULT -1,
      SEGUE_END_POINT INT DEFAULT -1,
      HOOK_START_POINT INT DEFAULT -1,
      HOOK_END_POINT INT DEFAULT -1,
      TALK_START_POINT INT DEFAULT -1,
      TALK_END_POINT INT DEFAULT -1,
      INDEX CART_NUMBER_IDX (CART_NUMBER),
      INDEX DESCRIPTION_IDX (DESCRIPTION),
      INDEX OUTCUE_IDX (OUTCUE),
      INDEX ORIGIN_DATETIME_IDX (ORIGIN_DATETIME),
      INDEX START_DATETIME_IDX (START_DATETIME),
      INDEX END_DATETIME_IDX (END_DATETIME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON CUTS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create CLIPBOARD table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS CLIPBOARD (
      CUT_NAME CHAR(12) PRIMARY KEY NOT NULL,
      CART_NUMBER INT UNSIGNED NOT NULL,
      DESCRIPTION CHAR(64),
      OUTCUE CHAR(64),
      LENGTH INT UNSIGNED,
      ORIGIN_DATETIME DATETIME,
      ORIGIN_NAME CHAR(64),
      WEIGHT INT UNSIGNED DEFAULT 1,
      LAST_PLAY_DATETIME DATETIME,
      PLAY_COUNTER INT UNSIGNED DEFAULT 0,
      CODING_FORMAT INT UNSIGNED,
      SAMPLE_RATE INT UNSIGNED,
      BIT_RATE INT UNSIGNED,
      CHANNELS INT UNSIGNED,
      PLAY_GAIN INT DEFAULT 0,
      START_POINT INT DEFAULT -1,
      END_POINT INT DEFAULT -1,
      FADEUP_POINT INT DEFAULT -1,
      FADEDOWN_POINT INT DEFAULT -1,
      SEGUE_START_POINT INT DEFAULT -1,
      SEGUE_END_POINT INT DEFAULT -1,
      HOOK_START_POINT INT DEFAULT -1,
      HOOK_END_POINT INT DEFAULT -1,
      TALK_START_POINT INT DEFAULT -1,
      TALK_END_POINT INT DEFAULT -1,
      INDEX CART_NUMBER_IDX (CART_NUMBER),
      INDEX DESCRIPTION_IDX (DESCRIPTION),
      INDEX OUTCUE_IDX (OUTCUE)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON CLIPBOARD TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create SERVICES table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS SERVICES (
      NAME CHAR(10) NOT NULL PRIMARY KEY,
      DESCRIPTION CHAR(255),
      PROGRAM_CODE CHAR(255),
      NAME_TEMPLATE CHAR(255),
      DESCRIPTION_TEMPLATE CHAR(255),
      TRACK_GROUP CHAR(255),
      AUTOSPOT_GROUP CHAR(255),
      CHAIN_LOG ENUM('N','Y') DEFAULT 'N',
      AUTO_REFRESH ENUM('N','Y') DEFAULT 'N',
      DEFAULT_LOG_SHELFLIFE INT DEFAULT -1,
      ELR_SHELFLIFE INT DEFAULT -1,
      TFC_PATH CHAR(255),
      TFC_PREIMPORT_CMD CHAR(255),
      TFC_WIN_PREIMPORT_CMD CHAR(255),
      TFC_WIN_PATH CHAR(255),
      TFC_IMPORT_TEMPLATE CHAR(255),
      TFC_LABEL_CART CHAR(255),
      TFC_TRACK_STRING CHAR(255),
      TFC_CART_OFFSET INT,
      TFC_CART_LENGTH INT,
      TFC_TITLE_OFFSET INT,
      TFC_TITLE_LENGTH INT,
      TFC_HOURS_OFFSET INT,
      TFC_HOURS_LENGTH INT,
      TFC_MINUTES_OFFSET INT,
      TFC_MINUTES_LENGTH INT,
      TFC_SECONDS_OFFSET INT,
      TFC_SECONDS_LENGTH INT,
      TFC_LEN_HOURS_OFFSET INT,
      TFC_LEN_HOURS_LENGTH INT,
      TFC_LEN_MINUTES_OFFSET INT,
      TFC_LEN_MINUTES_LENGTH INT,
      TFC_LEN_SECONDS_OFFSET INT,
      TFC_LEN_SECONDS_LENGTH INT,
      TFC_DATA_OFFSET INT,
      TFC_DATA_LENGTH INT,
      TFC_EVENT_ID_OFFSET INT,
      TFC_EVENT_ID_LENGTH INT,
      TFC_ANNC_TYPE_OFFSET INT,
      TFC_ANNC_TYPE_LENGTH INT,
      MUS_PATH CHAR(255),
      MUS_PREIMPORT_CMD CHAR(255),
      MUS_WIN_PREIMPORT_CMD CHAR(255),
      MUS_WIN_PATH CHAR(255),
      MUS_IMPORT_TEMPLATE CHAR(255),
      MUS_BREAK_STRING CHAR(255),
      MUS_LABEL_CART CHAR(255),
      MUS_TRACK_STRING CHAR(255),
      MUS_CART_OFFSET INT,
      MUS_CART_LENGTH INT,
      MUS_TITLE_OFFSET INT,
      MUS_TITLE_LENGTH INT,
      MUS_HOURS_OFFSET INT,
      MUS_HOURS_LENGTH INT,
      MUS_MINUTES_OFFSET INT,
      MUS_MINUTES_LENGTH INT,
      MUS_SECONDS_OFFSET INT,
      MUS_SECONDS_LENGTH INT,
      MUS_LEN_HOURS_OFFSET INT,
      MUS_LEN_HOURS_LENGTH INT,
      MUS_LEN_MINUTES_OFFSET INT,
      MUS_LEN_MINUTES_LENGTH INT,
      MUS_LEN_SECONDS_OFFSET INT,
      MUS_LEN_SECONDS_LENGTH INT,
      MUS_DATA_OFFSET INT,
      MUS_DATA_LENGTH INT,
      MUS_EVENT_ID_OFFSET INT,
      MUS_EVENT_ID_LENGTH INT,
      MUS_ANNC_TYPE_OFFSET INT,
      MUS_ANNC_TYPE_LENGTH INT
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON SERVICES TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create SERVICE_PERMS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS SERVICE_PERMS (
      ID INT AUTO_INCREMENT NOT NULL PRIMARY KEY,
      SERVICE_NAME CHAR(64),
      STATION_NAME CHAR(64),
      INDEX SERVICE_NAME_IDX (SERVICE_NAME),
      INDEX STATION_NAME_IDX (STATION_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON SERVICE_PERMS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create GROUPS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS GROUPS (
      NAME CHAR(10) NOT NULL PRIMARY KEY,
      DESCRIPTION CHAR(255),
      DEFAULT_TITLE CHAR(50),
      DEFAULT_CART_TYPE INT,
      DEFAULT_LOW_CART INT,
      DEFAULT_HIGH_CART INT,
      ENFORCE_CART_RANGE ENUM('N','Y') DEFAULT 'N',
      REPORT_TFC ENUM('N','Y') DEFAULT 'N',
      REPORT_MUS ENUM('N','Y') DEFAULT 'N',
      CUT_SHELFLIFE INT DEFAULT -1,
      DELETE_EMPTY_CARTS ENUM('N','Y') DEFAULT 'N',
      ENABLE_NOW_NEXT ENUM('N','Y') DEFAULT 'N',
      COLOR CHAR(8),
      INDEX NAME_IDX (NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON GROUPS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create AUDIO_PERMS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS AUDIO_PERMS (
      ID INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
      GROUP_NAME CHAR(10),
      SERVICE_NAME CHAR(10),
      INDEX GROUP_IDX (GROUP_NAME),
      INDEX SERVICE_IDX (SERVICE_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON AUDIO_PERMS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create USER_PERMS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS USER_PERMS (
      ID INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
      USER_NAME CHAR(10),
      GROUP_NAME CHAR(10),
      INDEX USER_IDX (USER_NAME),
      INDEX GROUP_IDX (GROUP_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON AUDIO_PERMS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDLIBRARY table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS RDLIBRARY (
      ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
      STATION CHAR(40) NOT NULL,
      INSTANCE INT UNSIGNED NOT NULL DEFAULT 0,
      INPUT_CARD INT DEFAULT -1,
      INPUT_STREAM INT DEFAULT -1,
      INPUT_PORT INT DEFAULT -1,
      INPUT_TYPE ENUM('A','D') DEFAULT 'A',
      OUTPUT_CARD INT DEFAULT -1,
      OUTPUT_STREAM INT DEFAULT -1,
      OUTPUT_PORT INT DEFAULT -1,
      VOX_THRESHOLD INT DEFAULT -5000,
      TRIM_THRESHOLD INT DEFAULT -3000,
      RECORD_GPI INT DEFAULT -1,
      PLAY_GPI INT DEFAULT -1,
      STOP_GPI INT DEFAULT -1,
      DEFAULT_FORMAT INT UNSIGNED DEFAULT 0,
      DEFAULT_CHANNELS INT UNSIGNED DEFAULT 2,
      DEFAULT_SAMPRATE INT UNSIGNED DEFAULT 44100,
      DEFAULT_LAYER INT UNSIGNED DEFAULT 0,
      DEFAULT_BITRATE INT UNSIGNED DEFAULT 0,
      DEFAULT_RECORD_MODE INT UNSIGNED DEFAULT 0,
      DEFAULT_TRIM_STATE ENUM('N','Y') DEFAULT 'N',
      MAXLENGTH INT,
      TAIL_PREROLL INT UNSIGNED DEFAULT 1500,
      RIPPER_DEVICE CHAR(64) DEFAULT \"/dev/cdrom\",
      PARANOIA_LEVEL INT DEFAULT 0,
      RIPPER_LEVEL INT DEFAULT 0,
      CDDB_SERVER CHAR(64) DEFAULT \"freedb.freedb.org\",
      READ_ISRC ENUM('N','Y') DEFAULT 'N',
      ENABLE_EDITOR ENUM('N','Y') DEFAULT 'N',
      SRC_CONVERTER INT,
      LIMIT_SEARCH INT,
      INDEX STATION_IDX (STATION,INSTANCE)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDLIBRARY TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create TRIGGERS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS TRIGGERS (
      ID INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
      CUT_NAME CHAR(12),
      TRIGGER_CODE INT UNSIGNED,
      OFFSET INT UNSIGNED,
      INDEX CUT_NAME_IDX (CUT_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON TRIGGERS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create TTYS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS TTYS (
      ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
      PORT_ID INT UNSIGNED NOT NULL,
      ACTIVE ENUM('N','Y') NOT NULL DEFAULT 'N',
      STATION_NAME CHAR(64) NOT NULL,
      PORT CHAR(20),
      BAUD_RATE INT DEFAULT 9600,
      DATA_BITS INT DEFAULT 8,
      STOP_BITS INT DEFAULT 1,      
      PARITY INT DEFAULT 0,
      TERMINATION INT DEFAULT 0,
      INDEX STATION_NAME_IDX (STATION_NAME),
      INDEX ACTIVE_IDX (ACTIVE),
      INDEX PORT_ID_IDX (PORT_ID)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON TTYS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create DECKS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS DECKS (
      ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
      STATION_NAME CHAR(64) NOT NULL,
      CHANNEL INT UNSIGNED NOT NULL,
      CARD_NUMBER INT DEFAULT -1,
      STREAM_NUMBER INT DEFAULT -1,
      PORT_NUMBER INT DEFAULT -1,
      PORT_TYPE ENUM('A','D') DEFAULT 'A',
      DEFAULT_FORMAT INT DEFAULT 0,
      DEFAULT_CHANNELS INT DEFAULT 2,
      DEFAULT_SAMPRATE INT DEFAULT 44100,
      DEFAULT_BITRATE INT DEFAULT 0,
      DEFAULT_THRESHOLD INT DEFAULT 0,
      SWITCH_TYPE INT DEFAULT 0,
      TTY_ID INT,
      SWITCH_STATION CHAR(60),
      SWITCH_MATRIX INT,
      SWITCH_OUTPUT INT DEFAULT -1,
      SWITCH_DELAY INT UNSIGNED DEFAULT 0,
      MON_PORT_NUMBER INT UNSIGNED,
      DEFAULT_MONITOR_ON ENUM('N','Y') DEFAULT 'N',
      INDEX STATION_NAME_IDX (STATION_NAME),
      INDEX CHANNEL_IDX (CHANNEL)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON DECKS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create SOURCES table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS SOURCES (
      ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
      STATION_NAME CHAR(64) NOT NULL,
      CHANNEL INT UNSIGNED NOT NULL,
      SOURCE_NAME CHAR(64) NOT NULL,
      SERIAL_COMMAND CHAR(64),
      GPO_LINE INT UNSIGNED,
      INDEX STATION_NAME_IDX (STATION_NAME),
      INDEX CHANNEL_IDX (CHANNEL),
      INDEX SOURCE_NAME_IDX (SOURCE_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON SOURCES TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create DECK_EVENTS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS DECK_EVENTS (
      STATION_NAME CHAR(60) NOT NULL PRIMARY KEY,
      CHANNEL INT,
      NUMBER INT,
      CART_NUMBER INT,
      INDEX CHANNEL_IDX (CHANNEL),
      INDEX NUMBER_IDX (NUMBER)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON DECK_EVENTS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RECORDINGS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS RECORDINGS (
      ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
      STATION_NAME CHAR(64) NOT NULL,
      TYPE INT DEFAULT 0,
      IS_ACTIVE ENUM('N','Y') DEFAULT 'N',
      CHANNEL INT UNSIGNED NOT NULL,
      CUT_NAME CHAR(12) NOT NULL,
      SUN ENUM('N','Y') DEFAULT 'N',
      MON ENUM('N','Y') DEFAULT 'N',
      TUE ENUM('N','Y') DEFAULT 'N',
      WED ENUM('N','Y') DEFAULT 'N',
      THU ENUM('N','Y') DEFAULT 'N',
      FRI ENUM('N','Y') DEFAULT 'N',
      SAT ENUM('N','Y') DEFAULT 'N',
      SOURCE_NAME CHAR(64),
      DESCRIPTION CHAR(64),
      START_TIME TIME,
      LENGTH INT UNSIGNED,
      START_GPI INT DEFAULT -1,
      END_GPI INT DEFAULT -1,
      TRIM_THRESHOLD INT UNSIGNED,
      STARTDATE_OFFSET INT UNSIGNED DEFAULT 0,
      ENDDATE_OFFSET INT UNSIGNED DEFAULT 0,
      FORMAT INT DEFAULT 0,
      CHANNELS INT DEFAULT 2,
      SAMPRATE INT DEFAULT 44100,
      BITRATE INT DEFAULT 0,
      MACRO_CART INT,
      SWITCH_INPUT INT,
      SWITCH_OUTPUT INT,
      ONE_SHOT CHAR(60),
      START_TYPE INT DEFAULT 0,
      START_LENGTH INT DEFAULT 0,
      START_MATRIX INT DEFAULT 0,
      START_LINE INT DEFAULT 0,
      START_OFFSET INT DEFAULT 0,
      END_TYPE INT DEFAULT 0,
      END_TIME TIME,
      END_LENGTH INT DEFAULT 0,
      END_MATRIX INT DEFAULT 0,
      END_LINE INT DEFAULT 0,
      END_OFFSET INT DEFAULT 0,
      URL CHAR(255),
      URL_USERNAME CHAR(60),
      URL_PASSWORD CHAR(60),
      QUALITY INT,
      NORMALIZE_LEVEL INT DEFAULT 0,
      ALLOW_MULT_RECS ENUM('N','Y') DEFAULT 'N',
      MAX_GPI_REC_LENGTH INT,
      FEED_ID INT UNSIGNED,
      EVENTDATE_OFFSET INT,
      ENABLE_METADATA ENUM('N','Y') DEFAULT 'N',
      INDEX STATION_NAME_IDX (STATION_NAME),
      INDEX CHANNEL_IDX (CHANNEL),
      INDEX CUT_NAME_IDX (CUT_NAME),
      INDEX SOURCE_NAME_IDX (SOURCE_NAME),
      INDEX SUN_IDX (SUN),
      INDEX MON_IDX (MON),
      INDEX TUE_IDX (TUE),
      INDEX WED_IDX (WED),
      INDEX THU_IDX (THU),
      INDEX FRI_IDX (FRI),
      INDEX SAT_IDX (SAT)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RECORDINGS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create AUDIO_PORTS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS AUDIO_PORTS (
      ID INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
      STATION_NAME CHAR(64) NOT NULL,
      CARD_NUMBER INT NOT NULL,
      CLOCK_SOURCE INT DEFAULT 0,
      INPUT_0_MODE INT DEFAULT 0,
      INPUT_0_LEVEL INT DEFAULT 0,
      INPUT_0_TYPE INT DEFAULT 0,
      INPUT_1_MODE INT DEFAULT 0,
      INPUT_1_LEVEL INT DEFAULT 0,
      INPUT_1_TYPE INT DEFAULT 0,
      INPUT_2_MODE INT DEFAULT 0,
      INPUT_2_LEVEL INT DEFAULT 0,
      INPUT_2_TYPE INT DEFAULT 0,
      INPUT_3_MODE INT DEFAULT 0,
      INPUT_3_LEVEL INT DEFAULT 0,
      INPUT_3_TYPE INT DEFAULT 0,
      INPUT_4_MODE INT DEFAULT 0,
      INPUT_4_LEVEL INT DEFAULT 0,
      INPUT_4_TYPE INT DEFAULT 0,
      INPUT_5_MODE INT DEFAULT 0,
      INPUT_5_LEVEL INT DEFAULT 0,
      INPUT_5_TYPE INT DEFAULT 0,
      INPUT_6_MODE INT DEFAULT 0,
      INPUT_6_LEVEL INT DEFAULT 0,
      INPUT_6_TYPE INT DEFAULT 0,
      INPUT_7_MODE INT DEFAULT 0,
      INPUT_7_LEVEL INT DEFAULT 0,
      INPUT_7_TYPE INT DEFAULT 0,
      OUTPUT_0_LEVEL INT DEFAULT 0,
      OUTPUT_1_LEVEL INT DEFAULT 0,
      OUTPUT_2_LEVEL INT DEFAULT 0,
      OUTPUT_3_LEVEL INT DEFAULT 0,
      OUTPUT_4_LEVEL INT DEFAULT 0,
      OUTPUT_5_LEVEL INT DEFAULT 0,
      OUTPUT_6_LEVEL INT DEFAULT 0,
      OUTPUT_7_LEVEL INT DEFAULT 0,
      INDEX STATION_NAME_IDX (STATION_NAME),
      INDEX CARD_NUMBER_IDX (CARD_NUMBER)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON AUDIO_PORTS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create LOGS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS LOGS (
      NAME CHAR(64) NOT NULL PRIMARY KEY,
      SERVICE CHAR(10) NOT NULL,
      DESCRIPTION CHAR(64),
      ORIGIN_USER CHAR(8) NOT NULL,
      ORIGIN_DATETIME DATETIME NOT NULL,
      START_DATE DATE NOT NULL DEFAULT '1000-01-01',
      END_DATE DATE NOT NULL DEFAULT '1000-01-01',
      INDEX SERVICE_IDX (SERVICE),
      INDEX DESCRIPTION_IDX (DESCRIPTION),
      INDEX ORIGIN_USER_IDX (ORIGIN_USER),
      INDEX START_DATE_IDX (START_DATE),
      INDEX END_DATE_IDX (END_DATE)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON LOGS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create VERSION table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS VERSION (
      DB INT NOT NULL PRIMARY KEY
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON VERSION TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDLOGEDIT table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS RDLOGEDIT (
      ID INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
      STATION CHAR(64) NOT NULL
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDLOGEDIT TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create REPORTS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS REPORTS (
      NAME CHAR(60) NOT NULL PRIMARY KEY,
      DESCRIPTION CHAR(255),
      EXPORT_FILTER INT DEFAULT 0,
      STATION_ID CHAR(64),
      CART_DIGITS INT DEFAULT 0,
      USE_LEADING_ZEROS ENUM('N','Y') DEFAULT 'N',
      LINES_PER_PAGE INT DEFAULT 10,
      STATION_TYPE INT DEFAULT 0,
      SERVICE_NAME CHAR(60),
      STATION_FORMAT CHAR(10),
      EXPORT_PATH CHAR(255),
      POST_EXPORT_CMD CHAR(255),
      WIN_EXPORT_PATH CHAR(255),
      WIN_POST_EXPORT_CMD CHAR(255),
      EXPORT_TFC ENUM('N','Y') DEFAULT 'N',
      EXPORT_MUS ENUM('N','Y') DEFAULT 'N',
      FORCE_TFC ENUM('N','Y') DEFAULT 'N',
      FORCE_MUS ENUM('N','Y') DEFAULT 'N',
      EXPORT_GEN ENUM('N','Y') DEFAULT 'N',
      FILTER_ONAIR_FLAG ENUM('N','Y') DEFAULT 'N',
      FILTER_GROUPS ENUM('N','Y') DEFAULT 'N',
      START_TIME TIME,
      END_TIME TIME,
      INDEX SERVICE_NAME_IDX (SERVICE_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON REPORTS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create REPORT_SERVICES table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS REPORT_SERVICES (
      REPORT_NAME CHAR(60) PRIMARY KEY,
      SERVICE_NAME CHAR(60),
      INDEX SERVICE_NAME_IDX (SERVICE_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON REPORT_SERVICES TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create REPORT_STATIONS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS REPORT_STATIONS (
      REPORT_NAME CHAR(60) PRIMARY KEY,
      STATION_NAME CHAR(60),
      INDEX STATION_NAME_IDX (STATION_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON REPORT_STATIONS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create REPORT_GROUPS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS REPORT_GROUPS (
      REPORT_NAME CHAR(60) PRIMARY KEY,
      GROUP_NAME CHAR(60),
      INDEX GROUP_NAME_IDX (GROUP_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON REPORT_GROUPS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create LOG_MODES table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS LOG_MODES (
      STATION_NAME CHAR(60) PRIMARY KEY,
      MACHINE INT UNSIGNED,
      START_MODE INT,
      OP_MODE INT,
      INDEX MACHINE_IDX (MACHINE)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON LOG_MODES TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDAIRPLAY_CHANNELS table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS RDAIRPLAY_CHANNELS (
      STATION_NAME CHAR(60) PRIMARY KEY,
      INSTANCE INT,
      START_RML CHAR(10),
      STOP_RML CHAR(10),
      CARD INT,
      PORT INT DEFAULT -1,
      START_GPI_MATRIX INT DEFAULT -1,
      START_GPO_MATRIX INT DEFAULT -1,
      STOP_GPI_MATRIX INT DEFAULT -1,
      STOP_GPO_MATRIX INT DEFAULT -1,
      INDEX INSTANCE_IDX (INSTANCE)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDAIRPLAY_CHANNELS TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDAIRPLAY table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS RDAIRPLAY (
      ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      STATION CHAR(60),
      SEGUE_LENGTH INT,
      TRANS_LENGTH INT,
      PIE_COUNT_LENGTH INT,
      PIE_COUNT_ENDPOINT INT,
      DEFAULT_TRANS_TYPE INT,
      DEFAULT_SERVICE CHAR(60),
      STATION_PANELS INT,
      USER_PANELS INT,
      SHOW_AUX_1 ENUM('N','Y') DEFAULT 'N',
      SHOW_AUX_2 ENUM('N','Y') DEFAULT 'N',
      CLEAR_FILTER ENUM('N','Y') DEFAULT 'N',
      BAR_ACTION INT,
      FLASH_PANEL ENUM('N','Y') DEFAULT 'N',
      CHECK_TIMESYNC ENUM('N','Y') DEFAULT 'N',
      PANEL_PAUSE_ENABLED ENUM('N','Y') DEFAULT 'N',
      BUTTON_LABEL_TEMPLATE CHAR(255),
      PAUSE_ENABLED ENUM('N','Y') DEFAULT 'N',
      SHOW_COUNTERS ENUM('N','Y') DEFAULT 'N',
      HOUR_SELECTOR_ENABLED ENUM('N','Y') DEFAULT 'N',
      AUDITION_PREROLL INT DEFAULT 1000,
      TITLE_TEMPLATE CHAR(50),
      ARTIST_TEMPLATE CHAR(50),
      OUTCUE_TEMPLATE CHAR(50),
      DESCRIPTION_TEMPLATE CHAR(255),
      LOG_MODE_STYLE INT,
      LOG0_START_MODE INT,
      LOG0_LOG_NAME CHAR(60),
      LOG0_AUTO_RESTART ENUM('N','Y') DEFAULT 'N',
      LOG1_START_MODE INT,
      LOG1_LOG_NAME CHAR(60),
      LOG1_AUTO_RESTART ENUM('N','Y') DEFAULT 'N',
      LOG2_START_MODE INT,
      LOG2_LOG_NAME CHAR(60),
      LOG2_AUTO_RESTART ENUM('N','Y') DEFAULT 'N',
      SKIN_PATH CHAR(255),
      EXIT_PASSWORD CHAR(100),
      INDEX STATION_IDX (STATION),
      INDEX DEFAULT_SERVICE_IDX (DEFAULT_SERVICE),
      INDEX LOG0_LOG_NAME_IDX (LOG0_LOG_NAME),
      INDEX LOG1_LOG_NAME_IDX (LOG1_LOG_NAME),
      INDEX LOG2_LOG_NAME_IDX (LOG2_LOG_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDAIRPLAY TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDCATCH table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS RDCATCH (
      ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      STATION CHAR(60),
      ERROR_RML CHAR(255),
      INDEX STATION_IDX (STATION)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDCATCH TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create RDPANEL table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS RDPANEL (
      ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      STATION CHAR(60),
      INDEX STATION_IDX (STATION)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON RDPANEL TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create SYSTEM table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS SYSTEM (
      ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      SAMPLE_RATE INT DEFAULT 32000,
      MAX_POST_LENGTH INT DEFAULT 10000000,
      ISCI_XREFERENCE_PATH CHAR(255),
      TEMP_CART_GROUP CHAR(60),
      DUP_CART_TITLES ENUM('N', 'Y') DEFAULT 'N',
      INDEX DUP_CART_TITLES_IDX (DUP_CART_TITLES)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON SYSTEM TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""

#
# Create DROPBOXES table
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell
      CREATE TABLE IF NOT EXISTS DROPBOXES (
      ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      STATION_NAME CHAR(60),
      GROUP_NAME CHAR(60),
      PATH CHAR(255),
      NORMALIZATION_LEVEL INT DEFAULT 0,
      AUTOTRIM_LEVEL INT DEFAULT 0,
      SINGLE_CART CHAR(60),
      TO_CART INT UNSIGNED,
      USE_CARTCHUNK_ID ENUM('N','Y') DEFAULT 'N',
      TITLE_FROM_CARTCHUNK_ID ENUM('N','Y') DEFAULT 'N',
      DELETE_CUTS ENUM('N','Y') DEFAULT 'N',
      DELETE_SOURCE ENUM('N','Y') DEFAULT 'N',
      METADATA_PATTERN CHAR(60),
      SET_USER_DEFINED CHAR(255),
      STARTDATE_OFFSET INT DEFAULT 0,
      ENDDATE_OFFSET INT DEFAULT 0,
      FIX_BROKEN_FORMATS ENUM('N','Y') DEFAULT 'N',
      LOG_PATH CHAR(255),
      IMPORT_CREATE_DATES ENUM('N','Y') DEFAULT 'N',
      CREATE_STARTDATE_OFFSET INT DEFAULT 0,
      CREATE_ENDDATE_OFFSET INT DEFAULT 0,
      INDEX STATION_NAME_IDX (STATION_NAME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON DROPBOXES TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""
}

# ############################################################################


# ############################################################################
# Initialize a Rivendell Database
# ############################################################################
function InitDB {
#
# Create Default Admin Account
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO USERS (LOGIN_NAME,PASSWORD,FULL_NAME,DESCRIPTION,ADMIN_USERS_PRIV,ADMIN_CONFIG_PRIV)
      VALUES (\"$RDA_LOGIN_NAME\",PASSWORD(\"$RDA_PASSWORD\"),\"$RDA_FULL_NAME\",\"$RDA_DESCRIPTION\",'Y','Y')"

#
# Create Default User Account
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO USERS (LOGIN_NAME,PASSWORD,FULL_NAME,DESCRIPTION,
		  CREATE_CARTS_PRIV,DELETE_CARTS_PRIV,MODIFY_CARTS_PRIV,
		  EDIT_AUDIO_PRIV,ASSIGN_CART_PRIV,CREATE_LOG_PRIV,
		  DELETE_LOG_PRIV,PLAYOUT_LOG_PRIV,ARRANGE_LOG_PRIV,
		  ADDTO_LOG_PRIV,REMOVEFROM_LOG_PRIV,EDIT_CATCHES_PRIV)
      VALUES (\"$USER_LOGIN_NAME\",PASSWORD(\"$USER_PASSWORD\"),\"$USER_FULL_NAME\",\"$USER_DESCRIPTION\",
              'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y')"

#
# Create Default Workstation
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO STATIONS (NAME,DESCRIPTION,USER_NAME,DEFAULT_NAME)
      VALUES (\"DEFAULT\",\"Default Workstation\",
      \"$USER_LOGIN_NAME\",\"$USER_LOGIN_NAME\")"

#
# Create Test Tone Cart
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO CART(TYPE,NUMBER,GROUP_NAME,TITLE,ARTIST,CUT_QUANTITY,
      FORCED_LENGTH)
      VALUES (1,999999,\"TEST\",\"Test Tone\",\"Salem Radio Labs\",1,10000)"

#
# Create Default Audio Cut
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO CUTS SET CUT_NAME=\"999999_000\",CART_NUMBER=999999,
      DESCRIPTION=\"1 kHz at Reference Level [-16 dBFS]\",
      OUTCUE=\"[tone]\",CODING_FORMAT=0,
      SAMPLE_RATE=44100,BIT_RATE=0,
      CHANNELS=2,LENGTH=10000,START_POINT=0,END_POINT=10000,
      ORIGIN_DATETIME=NOW(),ORIGIN_NAME=\"RDGen\""

#
# Create Clipboard Entry
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO CLIPBOARD SET CUT_NAME=\"clip\",CART_NUMBER=0,
      DESCRIPTION=\"Default Clipboard\""

#
# Create Default Service
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO SERVICES (NAME,DESCRIPTION) 
      VALUES (\"$RD_SVC_NAME\",\"$RD_SVC_DESC\")"

#
# Create Default Groups
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO GROUPS (NAME,DESCRIPTION) 
      VALUES (\"TEMP\",\"Temporary Carts\")"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO GROUPS (NAME,DESCRIPTION) 
      VALUES (\"TEST\",\"Test Carts\")"

#
# Create Default Audio Permissions
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO AUDIO_PERMS (GROUP_NAME,SERVICE_NAME) 
      VALUES (\"TEMP\",\"Production\")"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO AUDIO_PERMS (GROUP_NAME,SERVICE_NAME) 
      VALUES (\"TEST\",\"Production\")"

#
# Create Default Library Configuration
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO RDLIBRARY (STATION,INSTANCE) 
      VALUES (\"0.0.0.0|0.0.0.0:0\",0)"

#
# Create Sample Log
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      CREATE TABLE IF NOT EXISTS SAMPLE_LOG (
      ID INT NOT NULL PRIMARY KEY,
      COUNT INT NOT NULL,
      START_TIME TIME NOT NULL,
      CART_NUMBER INT UNSIGNED NOT NULL,
      TIME_TYPE INT NOT NULL,
      TRANS_TYPE INT NOT NULL,
      START_POINT INT NOT NULL DEFAULT -1,
      END_POINT INT NOT NULL DEFAULT -1,
      SEGUE_START_POINT INT NOT NULL DEFAULT -1,
      SEGUE_END_POINT INT NOT NULL DEFAULT -1,
      INDEX COUNT_IDX (COUNT),
      INDEX CART_NUMBER_IDX (CART_NUMBER),
      INDEX START_TIME_IDX (START_TIME)
)"
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      GRANT ALL ON SAMPLE_LOG TO $RD_USER IDENTIFIED BY \"$RD_PASSWORD\""
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO LOGS (NAME,SERVICE,DESCRIPTION,ORIGIN_USER,ORIGIN_DATETIME) 
      VALUES (\"SAMPLE\",\"Production\",\"Sample Log\",\"user\",NOW())"

#
# Populate Version details
#
mysql -u $USER -p$PASSWORD -e"USE Rivendell;
      INSERT INTO VERSION(DB)
      VALUES ($SCHEMA_VERSION)"
}

# ############################################################################


# ############################################################################
# Generate Default Audio
# ############################################################################
function GenerateAudio {
if [ -d $RD_AUDIO_ROOT ] ; then
  echo -n
else
  mkdir $RD_AUDIO_ROOT
fi
rdgen -t 10 -l 16 $RD_AUDIO_ROOT/999999_000.wav
chown -R $SHELL_NAME: $RD_AUDIO_ROOT
}
# ############################################################################


# ############################################################################
# Upgrade a Rivendell Database
# ############################################################################
function UpgradeDB {
#
# Create the temporary database
#
mysql -u $USER -p$PASSWORD -e"CREATE DATABASE IF NOT EXISTS Rivendell_TEMP"

#
# Dump primary database to temporary
#
mysqldump -u $USER -p$PASSWORD --opt Rivendell \
| mysql -u $USER -p$PASSWORD -C Rivendell_TEMP

#
# Delete the primary database
#
mysql -u $USER -p$PASSWORD -e"DROP DATABASE Rivendell"

#
# Create Upgraded Rivendell Database
#
CreateDB

#
# Restore Data from temporary Database
#
mysqldump -u $USER -p$PASSWORD --opt Rivendell_TEMP \
| mysql -u $USER -p$PASSWORD -C Rivendell

#
# Delete the temporary database
#
mysql -u $USER -p$PASSWORD -e"DROP DATABASE Rivendell_TEMP"
}
# ############################################################################


# ############################################################################
# Main Routine
# ############################################################################
#
# Get the mySQL Administrator Login
#
read -p "mySQL account with Admin access []: " USER
if [ -z $USER ] ; then
  echo "You must supply a mySQL administrator account name!"
  exit 1
fi
read -s -p "mySQL Password: " PASSWORD
echo

#
# Get the shell account user and group names
#
read -p "User account name that will be running Rivendell []: " SHELL_NAME
echo
if [ -z $SHELL_NAME ] ; then
  echo "You must supply a valid user account name!"
  echo
  exit 1
fi

#
# Check that mySQL is running and accessible
#
mysql -s -u $USER -p$PASSWORD -e"use mysql" 2> /dev/null
if [ $? -ne 0 ] ; then
  echo
  echo "*** Unable to connect to the mySQL server. ***"
  echo "It's possible that the server is not currently running, or that"
  echo "the name/password you've supplied are not correct.  Please"
  echo "correct the problem and try again."
  echo
  exit 1
fi

#
# Check for an existing Rivendell database
#
mysql -s -u $USER -p$PASSWORD -e"use Rivendell" 2> /dev/null
if [ $? -eq 0 ] ; then
  echo
  echo "*** A Rivendell database already exists! ***"
  echo "You can:"
  echo "  1) Overwrite it and create a new one."
  echo "     [WARNING: overwriting the database will COMPLETELY DESTROY"
  echo "     any existing data and audio!]"
  echo
  echo "  2) Upgrade the existing database."
  echo
  echo "  3) Exit this utility."
  echo
  read -p "Your choice [3]: " OVERWRITE
  echo
  case "$OVERWRITE" in
    "1")
      echo -n "Deleting old Rivendell database..."
      mysql -s -u $USER -p$PASSWORD -e"drop database Rivendell"
      echo "done."
      echo -n "Deleting old audio data..."
      rm $RD_AUDIO_ROOT/*
      echo "done."
      echo -n "Creating new Rivendell database..."
      CreateDB
      echo "done."
      echo -n "Initializing new Rivendell database..."
      InitDB
      echo "done."
      echo -n "Generating new audio data..."
      GenerateAudio
      echo "done."
      echo
      exit 0
    ;;

   "2")
     echo -n "Upgrading Rivendell database..."
     UpgradeDB
     echo "done."
     echo
     exit 0
   ;;

   "3" | "")
    echo "Database NOT overwritten or upgraded."
    echo
    exit 0
    ;;
  esac
fi 
# ############################################################################

# End of rd_create_db
